
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Fitting Synthetic Spectra &#8212; MATS 3 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Analysis of ASCENDS Line Spectra" href="Analysis%20of%20ASCENDS%20Line%20Spectra.html" />
    <link rel="prev" title="Fitting Experimental Spectra" href="Fitting%20Experimental%20Spectra.html" />
<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
<script>
$(document).ready(function(){
  // Mark external (non-nist.gov) A tags with class "external"
  //If the adress start with https and ends with nist.gov
  var re_nist = new RegExp('^https?:\/\/((^\/)*\.)*nist\\.gov(\/|$)');
  //Regex to find address that start with https
  var re_absolute_address = new RegExp('^((https?:)?\/\/)');
  $("a").each(function(){
    var url=$(this).attr('href');
    if(re_nist.test(url) || !re_absolute_address.test(url)){
      $(this).addClass('local');
    }else{
      //This a href appears to be external, so tag it
      $(this).addClass('external');
    }
  });
  // Add leaveNotice to external A elements
  $('a.external').leaveNotice();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Analysis%20of%20ASCENDS%20Line%20Spectra.html" title="Analysis of ASCENDS Line Spectra"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Fitting%20Experimental%20Spectra.html" title="Fitting Experimental Spectra"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MATS 3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Examples.html" accesskey="U">Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Fitting Synthetic Spectra</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="fitting-synthetic-spectra">
<h1>Fitting Synthetic Spectra<a class="headerlink" href="#fitting-synthetic-spectra" title="Permalink to this heading">¶</a></h1>
<p>Provided in the MATS v2 release are several examples highlighting MATS capabilities, which can be found in the MATS <a class="reference external" href="https://github.com/usnistgov/MATS/tree/master/Examples">examples folder</a>.</p>
<p>This example <a class="reference external" href="https://github.com/usnistgov/MATS/tree/master/Examples/Synthetic_Spectra">simulates and fits Oxygen A-Band spectra</a></p>
<section id="import-modules-and-set-up">
<h2>Import Modules and Set-Up<a class="headerlink" href="#import-modules-and-set-up" title="Permalink to this heading">¶</a></h2>
<p>This example starts with importing modules and setting up file locations</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">MATS</span>
</pre></div>
</div>
<p>Optional import of seaborn package for figure generation</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;ticks&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;poster&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you aren’t using the MATS file strucutre, change the path to the working directory that contains experimental spectra or to the folder that you want to work in.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="simulate-spectra">
<h2>Simulate Spectra<a class="headerlink" href="#simulate-spectra" title="Permalink to this heading">¶</a></h2>
<p>If you are simulating spectra, opposed to reading them in from a file as discussed above, then you can use the <a class="reference internal" href="MATS.html#MATS.spectrum.simulate_spectrum" title="MATS.spectrum.simulate_spectrum"><code class="xref py py-func docutils literal notranslate"><span class="pre">simulate_spectrum()</span></code></a> function.</p>
<p>When simulating spectra, the first step is to read in the reference line list.  This file can be generated following the <a class="reference internal" href="Generating%20Parameter%20Line%20lists.html#generating-parameter-line-lists"><span class="std std-ref">Generating Parameter Line lists</span></a> and read in using pd.read_csv function. The following code reads in the reference line list using the py:func:<cite>LoadLineListData</cite> function to read in the line list provided for the Oxygen A-Band.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MATS.linelistdata</span> <span class="kn">import</span> <span class="n">linelistdata</span>
<span class="n">PARAM_LINELIST</span> <span class="o">=</span> <span class="n">linelistdata</span><span class="p">[</span><span class="s1">&#39;O2_ABand_Drouin_2017_linelist&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Just as you would do if reading in the experimental spectrum, this example defines some common simulation and fit variables.  In addition to variables that would be used in fitting experimental spectra, the minimum and maximum wavenumbers for the simulation and the simulation wavenumber spacing are defined.  Alternatively, a wavenumbers term can be used and an array can be used as the input defining the x-axis.  This feature allows the use of a non-uniform x-axis and will take precident of the use of wave_min, wave_max, and wave_step parameterization.</p>
<p>The baseline is defined by a polynomial where the array index is the parameter coefficient order, such that the [1, 0] would correspond to a linear baseline with a slope of 0 and an offset of 1.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave_range</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="c1">#range outside of experimental x-range to simulate</span>
<span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span> <span class="c1">#intensities must be above this value to be simulated</span>
<span class="n">Fit_Intensity</span> <span class="o">=</span> <span class="mf">1e-24</span> <span class="c1">#intensities must be above this value for the line to be fit</span>
<span class="n">order_baseline_fit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sample_molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span> <span class="p">:</span><span class="mf">0.002022</span><span class="p">}</span>
<span class="n">wave_min</span> <span class="o">=</span> <span class="mi">13155</span> <span class="c1">#cm-1</span>
<span class="n">wave_max</span> <span class="o">=</span> <span class="mf">13157.5</span> <span class="c1">#cm-1</span>
<span class="n">wave_space</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="c1">#cm-1</span>
<span class="n">wavenumbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">13155</span><span class="p">,</span> <span class="mi">13158</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">baseline_terms</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#polynomial baseline coefficients where the index is equal to the coefficient order</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="MATS.html#MATS.spectrum.simulate_spectrum" title="MATS.spectrum.simulate_spectrum"><code class="xref py py-func docutils literal notranslate"><span class="pre">simulate_spectrum()</span></code></a> function also allows for error to be added in the following ways:</p>
<ul class="simple">
<li><p>to the absorption axis through signal-to-noise ratio (SNR).  The SNR is implemented by adding  gaussian noise to the spectra such that the (maximum alpha - minimum alpha) / noise is equal to the set SNR.</p></li>
<li><p>to the wavenumber axis through the wave_err parameter.  The wavenumber error is implemented by adding a gaussian noise error of the specified magnitude to the wavenumber axis.</p></li>
<li><p>to the mole fraction through the molefraction_err parameter.  The molefraction error is implemented as a percent error bias on each (could enter a negative percent error to get negative offset).  This mimics the maximum impact that a constant error in sample mole fraction would have.</p></li>
<li><p>to the temperature/pressure through the temperature_err and pressure_err dictionaries.  In experiments there are generally two type of errors with pressure and temperature measurements.  The first is a constant bias in the reading.  The second type of error is an actual change in the pressure/temperature during the collection of the spectrum.  To account for both error types the pressure_err and temperature_err are dictionaries, where the keys correspond to ‘bias/per_bias’ (bias for temperature and per_bias for pressure), function (allows ‘linear’ or ‘sine’), and params.  If the function is ‘linear’ then the param keys are ‘m’ and ‘b’ corresponding to the slope and interecept. If the function is ‘sine’ then the param keys are ‘amp’, ‘freq’, and ‘phase’ corresponding to the amplitude, period, and phase of the sine function.  For both temperature and pressure, the pressure/temperature recorded in the simulated spectra output include the average pressure or temperature over the segment (analogous to the frequency of the pressure/temperature measurement in an experiment) and does not include the bias in pressure/temperature as this is would be an unknown in an experiment.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SNR</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">wave_error</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">temperature_err</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">pressure_err</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;per_bias&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">molefraction_err</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="mf">0.01</span><span class="p">}</span>
</pre></div>
</div>
<p>These parameters and the additional settings for filenames and number of segments can be used to call the <a class="reference internal" href="MATS.html#MATS.spectrum.simulate_spectrum" title="MATS.spectrum.simulate_spectrum"><code class="xref py py-func docutils literal notranslate"><span class="pre">simulate_spectrum()</span></code></a> function setting the output equal to a variable as would be done for generating an instance of the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> class from a .csv file.  This makes it simple to transition code from analysis of experimental spectra to error analysis through simulations.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spec_1</span> <span class="o">=</span>  <span class="n">MATS</span><span class="o">.</span><span class="n">simulate_spectrum</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">wavenumbers</span> <span class="o">=</span> <span class="n">wavenumbers</span><span class="p">,</span> <span class="n">wave_error</span> <span class="o">=</span> <span class="n">wave_error</span><span class="p">,</span>
                     <span class="n">SNR</span> <span class="o">=</span> <span class="n">SNR</span><span class="p">,</span> <span class="n">baseline_terms</span> <span class="o">=</span> <span class="n">baseline_terms</span><span class="p">,</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">temperature_err</span> <span class="o">=</span> <span class="n">temperature_err</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
                     <span class="n">pressure_err</span> <span class="o">=</span> <span class="n">pressure_err</span><span class="p">,</span>
                     <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>  <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;25_torr&#39;</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="n">sample_molefraction</span><span class="p">,</span> <span class="n">molefraction_err</span> <span class="o">=</span> <span class="n">molefraction_err</span><span class="p">,</span>
                     <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span> <span class="n">num_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">spec_2</span> <span class="o">=</span>  <span class="n">MATS</span><span class="o">.</span><span class="n">simulate_spectrum</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">wave_min</span><span class="p">,</span> <span class="n">wave_max</span><span class="p">,</span> <span class="n">wave_space</span><span class="p">,</span> <span class="n">wave_error</span> <span class="o">=</span> <span class="n">wave_error</span><span class="p">,</span>
                     <span class="n">SNR</span> <span class="o">=</span> <span class="n">SNR</span><span class="p">,</span> <span class="n">baseline_terms</span> <span class="o">=</span> <span class="n">baseline_terms</span><span class="p">,</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">temperature_err</span> <span class="o">=</span> <span class="n">temperature_err</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">pressure_err</span> <span class="o">=</span> <span class="n">pressure_err</span><span class="p">,</span>
                     <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>  <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;50_torr&#39;</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="n">sample_molefraction</span><span class="p">,</span> <span class="n">molefraction_err</span> <span class="o">=</span> <span class="n">molefraction_err</span><span class="p">,</span>
                     <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span> <span class="n">num_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">spec_3</span> <span class="o">=</span>  <span class="n">MATS</span><span class="o">.</span><span class="n">simulate_spectrum</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">wave_min</span><span class="p">,</span> <span class="n">wave_max</span><span class="p">,</span> <span class="n">wave_space</span><span class="p">,</span> <span class="n">wave_error</span> <span class="o">=</span> <span class="n">wave_error</span><span class="p">,</span>
                     <span class="n">SNR</span> <span class="o">=</span> <span class="n">SNR</span><span class="p">,</span> <span class="n">baseline_terms</span> <span class="o">=</span> <span class="n">baseline_terms</span><span class="p">,</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">temperature_err</span> <span class="o">=</span> <span class="n">temperature_err</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                     <span class="n">pressure_err</span> <span class="o">=</span> <span class="n">pressure_err</span><span class="p">,</span>
                     <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>  <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;100_torr&#39;</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="n">sample_molefraction</span><span class="p">,</span> <span class="n">molefraction_err</span> <span class="o">=</span> <span class="n">molefraction_err</span><span class="p">,</span>
                     <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span> <span class="n">num_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">spec_4</span> <span class="o">=</span>  <span class="n">MATS</span><span class="o">.</span><span class="n">simulate_spectrum</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">wave_min</span><span class="p">,</span> <span class="n">wave_max</span><span class="p">,</span> <span class="n">wave_space</span><span class="p">,</span> <span class="n">wave_error</span> <span class="o">=</span> <span class="n">wave_error</span><span class="p">,</span>
                     <span class="n">SNR</span> <span class="o">=</span> <span class="n">SNR</span><span class="p">,</span> <span class="n">baseline_terms</span> <span class="o">=</span> <span class="n">baseline_terms</span><span class="p">,</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">temperature_err</span> <span class="o">=</span> <span class="n">temperature_err</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
                     <span class="n">pressure_err</span> <span class="o">=</span> <span class="n">pressure_err</span><span class="p">,</span>
                     <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>  <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;200_torr&#39;</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="n">sample_molefraction</span><span class="p">,</span> <span class="n">molefraction_err</span> <span class="o">=</span> <span class="n">molefraction_err</span><span class="p">,</span>
                     <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span> <span class="n">num_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="generate-a-dataset">
<h2>Generate a Dataset<a class="headerlink" href="#generate-a-dataset" title="Permalink to this heading">¶</a></h2>
<p>The procedure for analysis for both simulating and loading spectrum are the same as described in <a class="reference internal" href="Fitting%20Experimental%20Spectra.html#fitting-experimental-spectra"><span class="std std-ref">Fitting Experimental Spectra</span></a>. The next step is to combine all desired <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> objects</p>
<p>into a <a class="reference internal" href="MATS.html#MATS.dataset.Dataset" title="MATS.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> object, where we give the dataset a name and specify the parameter line list to use for analysis/</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SPECTRA</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Dataset</span><span class="p">([</span><span class="n">spec_1</span><span class="p">,</span> <span class="n">spec_2</span><span class="p">,</span> <span class="n">spec_3</span><span class="p">,</span> <span class="n">spec_4</span><span class="p">],</span> <span class="s1">&#39;Line Intensity&#39;</span><span class="p">,</span> <span class="n">PARAM_LINELIST</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="MATS.html#MATS.dataset.Dataset" title="MATS.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> class contains a function to generate a baseline line list, analogous to the one for the parameter line list done outside of this example, based on the order of the baseline fit, etalons, molecules, x-shift parameters, and segments as defined by both the spectrum and dataset objects.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BASE_LINELIST</span> <span class="o">=</span> <span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_baseline_paramlist</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="generate-fit-parameter-files">
<h2>Generate Fit Parameter Files<a class="headerlink" href="#generate-fit-parameter-files" title="Permalink to this heading">¶</a></h2>
<p>The next section of code uses the <a class="reference internal" href="MATS.html#MATS.generate_fitparam_file.Generate_FitParam_File" title="MATS.generate_fitparam_file.Generate_FitParam_File"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generate_FitParam_File</span></code></a> class to define what line shape to use for the initial fits, whether to use line mixing, the minimum line intensity to fit a line, mimimum intensity to included in the simulation, and for each line parameter whether that parameter is going to be constrained across all spectra or whether there will be a parameter for each spectrum (multi-spectrum vs single-spectrum fits) on a parameter by parameter basis.  In the example below, the SDVP line profile without line mixing will be used to fit lines with line intensities greater than 1e-24 with no parameters floated.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FITPARAMS</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Generate_FitParam_File</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span> <span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">BASE_LINELIST</span><span class="p">,</span> <span class="n">lineprofile</span> <span class="o">=</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">,</span> <span class="n">linemixing</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">threshold_intensity</span> <span class="o">=</span> <span class="n">IntensityThreshold</span><span class="p">,</span> <span class="n">sim_window</span> <span class="o">=</span> <span class="n">wave_range</span><span class="p">,</span>
                               <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="n">aw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eta_constrain</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linemixing_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to generate fit parameter and baseline line lists that include columns that specify whether that parameter should be varied during fitting, in addition to adding error columns for the fit error for each parameter.  For the following example the line centers, line intensities, collisional half-widths, and speed-dependent broadening terms will be floated for all main oxygen isotopes for lines where the line intensity is greater than 1e-24. None of the baseline parameters are floated</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_param_linelist_from_linelist</span><span class="p">(</span><span class="n">vary_nu</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_sw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                 <span class="n">vary_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                 <span class="n">vary_aw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_gamma2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_as</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_delta2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_eta</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_linemixing</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>

<span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_baseline_linelist</span><span class="p">(</span><span class="n">vary_baseline</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">vary_xshift</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">vary_etalon_amp</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_etalon_period</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_etalon_phase</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                      <span class="n">vary_pressure</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_temperature</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>These functions will generate .csv files corresponding to these selections, which are read in by the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet" title="MATS.fit_dataset.Fit_DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fit_DataSet</span></code></a> class instantiation.  When simulating spectra, if you don’t adjust the baseline and parameter line lists, then your simulated variables are equal to your initial guesses.  This can lead to a local minimum where the fit will not move from the initial guesses.  The last segment of the code shows an example where random uncertainties from the simulated values are applied and then the Parameter line list file is resaved.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Parameter_LineList</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Parameter_LineList.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">Parameter_LineList</span><span class="p">[(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wave_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_min</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
 <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter_LineList</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mf">0.005</span><span class="p">)</span> <span class="c1">#adjust by random number scale 0.005 cm-1</span>
 <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter_LineList</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mf">0.01</span><span class="p">))</span> <span class="c1"># adjust by random amount at 1% scale</span>
 <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;gamma0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter_LineList</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mf">0.01</span><span class="p">))</span> <span class="c1"># adjust by random amount at 1% scale</span>
 <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter_LineList</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="s1">&#39;delta0_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mf">0.02</span><span class="p">))</span> <span class="c1"># adjust by random amount at 2% scale</span>
 <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter_LineList</span><span class="p">[</span><span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mf">0.1</span><span class="p">))</span> <span class="c1"># adjust by random amount at 10% scale</span>

<span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;Parameter_LineList.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fit-dataset">
<h2>Fit Dataset<a class="headerlink" href="#fit-dataset" title="Permalink to this heading">¶</a></h2>
<p>Instantiating the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet" title="MATS.fit_dataset.Fit_DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fit_DataSet</span></code></a> class reads in the information from the baseline and parameter linelists generated in the previous step.  The <span class="xref std std-ref">Fitting Experimental Spectra documentation</span> gives a more basic example of how to perform a fit.  The example below iterates on a fit, where in the first iteration no parameters are floated, in the second iteration the line centers and line intensities are floated, and in the final iteration the collisional broadening, pressure shift, and speed-dependent broadening are floated.  Sometimes it is not possible to float all parameters at the same time, specifically with poor initial guesses for line center.  In that case an iterative approach like this is advantageous.</p>
<p>The iteration could also be applied to the lmfit parameter object by setting the the vary term, opposed to through the Parameter_LineList.  In that approach the final Parameter_LineList would have the standard uncertainities and fit values saved, but wouldn’t necessarily have the parameter_vary column appropriately set.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">iteration</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
 <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;ITERATION &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iteration</span><span class="p">))</span>
 <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
     <span class="n">Parameter_LineList</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Parameter_LineList.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
     <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wave_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_min</span><span class="p">),</span> <span class="s1">&#39;nu_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wave_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_min</span><span class="p">),</span> <span class="s1">&#39;sw_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;Parameter_LineList.csv&#39;</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span><span class="mi">2</span><span class="p">:</span>
     <span class="n">Parameter_LineList</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Parameter_LineList.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
     <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wave_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_min</span><span class="p">),</span> <span class="s1">&#39;gamma0_air_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wave_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_min</span><span class="p">),</span> <span class="s1">&#39;delta0_air_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wave_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Parameter_LineList</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_min</span><span class="p">),</span> <span class="s1">&#39;SD_gamma_air_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="n">Parameter_LineList</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;Parameter_LineList.csv&#39;</span><span class="p">)</span>


 <span class="n">fit_data</span> <span class="o">=</span> <span class="n">Fit_DataSet</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span><span class="s1">&#39;Baseline_LineList&#39;</span><span class="p">,</span> <span class="s1">&#39;Parameter_LineList&#39;</span><span class="p">,</span> <span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">)</span>
 <span class="n">params</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">generate_params</span><span class="p">()</span>
 <span class="n">result</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">wing_wavenumbers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
 <span class="n">fit_data</span><span class="o">.</span><span class="n">residual_analysis</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indv_resid_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
 <span class="n">fit_data</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
 <span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_summary_file</span><span class="p">(</span><span class="n">save_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
 <span class="n">SPECTRA</span><span class="o">.</span><span class="n">plot_model_residuals</span><span class="p">()</span>
 <span class="n">iteration</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>
</div>
<p>The plots below show the results from the various iterations, where the fit residuals decrease with each iteration.</p>
<p><strong>Iteration 0</strong></p>
<img alt="_images/iteration_0.png" src="_images/iteration_0.png" />
<p><strong>Iteration 1</strong></p>
<img alt="_images/iteration_1.png" src="_images/iteration_1.png" />
<p><strong>Iteration 2</strong></p>
<img alt="_images/iteration_2.png" src="_images/iteration_2.png" />
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Fitting%20Experimental%20Spectra.html"
                          title="previous chapter">Fitting Experimental Spectra</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Analysis%20of%20ASCENDS%20Line%20Spectra.html"
                          title="next chapter">Analysis of ASCENDS Line Spectra</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Analysis%20of%20ASCENDS%20Line%20Spectra.html" title="Analysis of ASCENDS Line Spectra"
             >next</a> |</li>
        <li class="right" >
          <a href="Fitting%20Experimental%20Spectra.html" title="Fitting Experimental Spectra"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MATS 3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Examples.html" >Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Fitting Synthetic Spectra</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>