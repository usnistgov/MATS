
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Fitting Experimental Spectra &#8212; MATS 2.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fitting Synthetic Spectra" href="Fitting%20Synthetic%20Spectra.html" />
    <link rel="prev" title="Examples" href="Examples.html" />
<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
<script>
$(document).ready(function(){
  // Mark external (non-nist.gov) A tags with class "external"
  //If the adress start with https and ends with nist.gov
  var re_nist = new RegExp('^https?:\/\/((^\/)*\.)*nist\\.gov(\/|$)');
  //Regex to find address that start with https
  var re_absolute_address = new RegExp('^((https?:)?\/\/)');
  $("a").each(function(){
    var url=$(this).attr('href');
    if(re_nist.test(url) || !re_absolute_address.test(url)){
      $(this).addClass('local');
    }else{
      //This a href appears to be external, so tag it
      $(this).addClass('external');
    }
  });
  // Add leaveNotice to external A elements
  $('a.external').leaveNotice();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Fitting%20Synthetic%20Spectra.html" title="Fitting Synthetic Spectra"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Examples.html" title="Examples"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MATS 2.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Examples.html" accesskey="U">Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Fitting Experimental Spectra</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="fitting-experimental-spectra">
<h1>Fitting Experimental Spectra<a class="headerlink" href="#fitting-experimental-spectra" title="Permalink to this headline">¶</a></h1>
<p>Provided in the MATS v2 release are several examples highlighting MATS capabilities, which can be found in the MATS <a class="reference external" href="https://github.com/usnistgov/MATS/tree/master/Examples">examples folder</a>.</p>
<p>This example fits isolated Oxygen A-Band transitions in <a class="reference external" href="https://github.com/usnistgov/MATS/tree/master/Examples/Experimental_Spectra">experimental spectra</a></p>
<section id="import-modules-and-set-up">
<h2>Import Modules and Set-Up<a class="headerlink" href="#import-modules-and-set-up" title="Permalink to this headline">¶</a></h2>
<p>This example starts with importing modules and setting up file locations</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">MATS</span>
</pre></div>
</div>
<p>Optional import of seaborn package for figure generation</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;ticks&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;poster&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If not working within the MATS file structure, change the path to the working directory that contains experimental spectra or to the folder that you want to work in.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-spectra-from-files">
<h2>Load Spectra from files<a class="headerlink" href="#load-spectra-from-files" title="Permalink to this headline">¶</a></h2>
<p>There are two options for generating <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> objects.  The first is from a file by instantiating an instance of the class, which is the focus of this example.  The second option is by using the <a class="reference internal" href="MATS.html#MATS.spectrum.simulate_spectrum" title="MATS.spectrum.simulate_spectrum"><code class="xref py py-func docutils literal notranslate"><span class="pre">simulate_spectrum()</span></code></a> function described in the <a class="reference external" href="https://github.com/usnistgov/MATS/tree/master/MATS/Examples/Synthetic_Spectra">fitting synthetic spectra example</a>.</p>
<p>Before generating <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> objects from your experimental data, it is helpful to set some variables for terms that will be used in all of the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> objects and/or throughout the fitting.  In this example the minimum intensity threshold for simulation (IntensityThreshold), the minimum line intensity of lines  fit in the analysis (Fit_Intensity), the order of the polynomial used in the baseline fits, and the names of columns used for the absorption, frequency, pressure, and temperature data are defined at the top of the example.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave_range</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="c1">#range outside of experimental x-range to simulate</span>
<span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span> <span class="c1">#intensities must be above this value to be simulated</span>
<span class="n">Fit_Intensity</span> <span class="o">=</span> <span class="mf">1e-24</span> <span class="c1">#intensities must be above this value for the line to be fit</span>
<span class="n">order_baseline_fit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">tau_column</span> <span class="o">=</span> <span class="s1">&#39;Corrected Tau (us)&#39;</span> <span class="c1"># Mean tau/us</span>
<span class="n">freq_column</span> <span class="o">=</span> <span class="s1">&#39;Total Frequency (Detuning)&#39;</span> <span class="c1"># Total Frequency /MHz</span>
<span class="n">pressure_column</span> <span class="o">=</span> <span class="s1">&#39;Cavity Pressure /Torr&#39;</span>
<span class="n">temperature_column</span> <span class="o">=</span> <span class="s1">&#39;Cavity Temperature Side 2 /C&#39;</span>
</pre></div>
</div>
<p>After that, 4 instances of the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> class are instantiated from 4 experimental spectra.  In the class instantiation, the mole fraction of the oxygen sample used is defined, the etalon amplitude and period are defined, the sample is confirmed to be at natural abundance, the diluent is set to air, and the columns defined for pressure, temperature, frequency, and absorbance data are set.  All of these spectra were collected at nominally 296K, so the nominal temperature is set to be 296.  This variable is only used for a flag as to whether to allow temperature exponents to be floatable parameters and for generation of line mixing parameters for each nominal temperature as the temperature dependence of line mixing is not currently implemented.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spec_1</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;190510_2per_43_forfit&#39;</span><span class="p">,</span>
                     <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">7</span> <span class="p">:</span><span class="mf">0.01949</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                     <span class="n">etalons</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mf">0.001172</span><span class="p">,</span> <span class="mf">1.19574</span><span class="p">]},</span>
                     <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                     <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                     <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>
<span class="n">spec_2</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;190510_2per_55_forfit&#39;</span><span class="p">,</span>
                     <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">7</span> <span class="p">:</span> <span class="mf">0.01949</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                     <span class="n">etalons</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mf">0.001172</span><span class="p">,</span> <span class="mf">1.19574</span><span class="p">]},</span>
                     <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                     <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                     <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>
<span class="n">spec_3</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;190513_2per_82_forfit&#39;</span><span class="p">,</span>
                     <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">7</span> <span class="p">:</span><span class="mf">0.01949</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                     <span class="n">etalons</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mf">0.001172</span><span class="p">,</span> <span class="mf">1.19574</span><span class="p">]},</span>
                     <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                     <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                     <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>
<span class="n">spec_4</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;190514_2per_126_forfit&#39;</span><span class="p">,</span>
                     <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">7</span> <span class="p">:</span><span class="mf">0.01949</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                     <span class="n">etalons</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mf">0.001172</span><span class="p">,</span> <span class="mf">1.19574</span><span class="p">]},</span>
                     <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                     <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                     <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum.plot_wave_alpha" title="MATS.spectrum.Spectrum.plot_wave_alpha"><code class="xref py py-func docutils literal notranslate"><span class="pre">Spectrum.plot_wave_alpha()</span></code></a> function can be called to plot any of the spectra.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spec_1</span><span class="o">.</span><span class="n">plot_wave_alpha</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/plot_wave_alpha.png" src="_images/plot_wave_alpha.png" />
</section>
<section id="generate-a-dataset">
<h2>Generate a Dataset<a class="headerlink" href="#generate-a-dataset" title="Permalink to this headline">¶</a></h2>
<p>If the parameter line list hasn’t been read in from a .csv file, then do that now making sure to switch to the appropriate directories as needed.  This file can be generated following the <a class="reference internal" href="Generating%20Parameter%20Line%20lists.html#generating-parameter-line-lists"><span class="std std-ref">Generating Parameter Line lists</span></a>.  Alternatively, the code block below shows how to use the py:func:<cite>LoadLineListData</cite> function to read in the line list provided for the Oxygen A-Band.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MATS.linelistdata</span> <span class="kn">import</span> <span class="n">linelistdata</span>
<span class="n">PARAM_LINELIST</span> <span class="o">=</span> <span class="n">linelistdata</span><span class="p">[</span><span class="s1">&#39;O2_ABand_Drouin_2017_linelist&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The next step is to combine all desired <code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code> objects  into a <a class="reference internal" href="MATS.html#MATS.dataset.Dataset" title="MATS.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> object, where we give the dataset a name and specify the initial parameter line list to use for the fits.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SPECTRA</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Dataset</span><span class="p">([</span><span class="n">spec_1</span><span class="p">,</span> <span class="n">spec_2</span><span class="p">,</span> <span class="n">spec_3</span><span class="p">,</span> <span class="n">spec_4</span><span class="p">],</span> <span class="s1">&#39;Line Intensity&#39;</span><span class="p">,</span> <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="MATS.html#MATS.dataset.Dataset" title="MATS.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> class contains a function to generate a baseline line list, analogous to the one for the parameter line list (done outside of this example), based on the order of the baselines, etalons, molecules, x-shift parameters, and segments as defined by both the spectrum objects.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BASE_LINELIST</span> <span class="o">=</span> <span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_baseline_paramlist</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="generate-fit-parameter-files">
<h2>Generate Fit Parameter Files<a class="headerlink" href="#generate-fit-parameter-files" title="Permalink to this headline">¶</a></h2>
<p>The next section of code uses the <a class="reference internal" href="MATS.html#MATS.generate_fitparam_file.Generate_FitParam_File" title="MATS.generate_fitparam_file.Generate_FitParam_File"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generate_FitParam_File</span></code></a> class to define what line shape to use for the initial fits, whether to use line mixing, the minimum line intensity to fit a line, mimimum intensity to included in the simulation, and for each line parameter whether that parameter is going to be constrained across all spectra or whether there will be a parameter for each spectrum (multi-spectrum vs single-spectrum fits) on a parameter by parameter basis. In the example below, the SDVP line profile without line mixing will be used to fit lines with line intensities greater than 1e-24 and the line centers and line intensities will be allowed to float for each line, while all other lines are constrained across all spectra in the dataset. The additional_columns parameter allows for inclusion of additional columns in the line shape parameter line list to be included in the output file.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FITPARAMS</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Generate_FitParam_File</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span> <span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">BASE_LINELIST</span><span class="p">,</span> <span class="n">lineprofile</span> <span class="o">=</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">,</span> <span class="n">linemixing</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">threshold_intensity</span> <span class="o">=</span> <span class="n">IntensityThreshold</span><span class="p">,</span> <span class="n">sim_window</span> <span class="o">=</span> <span class="n">wave_range</span><span class="p">,</span>
                               <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="n">aw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eta_constrain</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linemixing_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="n">additional_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trans_id&#39;</span><span class="p">,</span> <span class="s1">&#39;local_lower_quanta&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The next step is to generate fit parameter and baseline line lists that include columns that specify whether that parameter should be varied during fitting, in addition to adding uncertainty columns for the fit error for each parameter. For the following example the line centers, line intensities, collisional half-widths, and speed-dependent broadening terms will be floated for all main oxygen isotopes for lines where the line intensity is greater than 1e-24. Additionally, the baseline terms will float, as will the etalon amplitude and phase.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_param_linelist_from_linelist</span><span class="p">(</span><span class="n">vary_nu</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_sw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                 <span class="n">vary_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                 <span class="n">vary_aw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_gamma2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_as</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_delta2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_eta</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_linemixing</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>

<span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_baseline_linelist</span><span class="p">(</span><span class="n">vary_baseline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">vary_xshift</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">vary_etalon_amp</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_etalon_period</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_etalon_phase</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>These functions will generate .csv files corresponding to these selections, which are read in by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Fit_DataSet</span></code> class instantiation.  This means that edits can be made manually to the .csv files or reading in the .csv, editing, and resaving before the next code segment is run.</p>
</section>
<section id="fit-dataset">
<h2>Fit Dataset<a class="headerlink" href="#fit-dataset" title="Permalink to this headline">¶</a></h2>
<p>Instantiating the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet" title="MATS.fit_dataset.Fit_DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fit_DataSet</span></code></a> class reads in the information from the baseline and parameter linelists generated in the previous step. It also allows for limits to be placed on the parameters, so that they don’t result in divergent solutions. The example below includes several limits including limiting the line center to be within 0.1 cm-1 of the initial guess and the Line intensity to be within a factor of 2 of the intial guess. Placing limits on the parameters can be restrictive on the solution and cause the fit to not converge or return NaN for the standard error if it doesn’t allow for a local minima to be found.  The <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet" title="MATS.fit_dataset.Fit_DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fit_DataSet</span></code></a> class also allows for the option to weight_spectra, currently this is set to False. Later in this example we will explore using weights in fitting.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_data</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Fit_DataSet</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span><span class="s1">&#39;Baseline_LineList&#39;</span><span class="p">,</span> <span class="s1">&#39;Parameter_LineList&#39;</span><span class="p">,</span> <span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">weight_spectra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">baseline_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">baseline_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="n">molefraction_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">molefraction_limit_factor</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span>
             <span class="n">etalon_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">etalon_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">#phase is constrained to +/- 2pi,</span>
             <span class="n">x_shift_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">x_shift_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
             <span class="n">nu_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nu_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
             <span class="n">sw_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sw_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">gamma0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_gamma0_limit</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">delta0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">delta0_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_delta0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_delta0_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">SD_gamma_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">SD_gamma_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_gamma2_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_gamma2_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">SD_delta_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">SD_delta_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">n_delta2_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_delta2_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">nuVC_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nuVC_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_nuVC_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_nuVC_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">eta_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">eta_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">linemixing_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linemixing_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to generate the <a class="reference external" href="https://lmfit.github.io/lmfit-py/parameters.html">lmfit</a> params dictionary object through the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet.generate_params" title="MATS.fit_dataset.Fit_DataSet.generate_params"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fit_DataSet.generate_params()</span></code></a> function.  This translates baseline and parameter line list .csv files into a lmfit parameter dictionary that is used in the fits.  After the parameters object is generated you can use the keys to set values and impose constraints on individual parameters, if desired.  While this is not coded in the MATS toolkit, it is incredibly powerful as it lets you define min, max, vary, and expression values for any parameter.  In the example below, two additional constraints are imposed on specific fit parameters.  The first constrains all speed-dependent width parameters to be between the values of 0.01 and 0.25 and the second forces the amplitude of the etalon to be constant across all spectra.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">generate_params</span><span class="p">()</span>



<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
             <span class="k">if</span> <span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                     <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">min</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
             <span class="k">if</span> <span class="s1">&#39;etalon_1_amp&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                     <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;etalon_1_amp_1_1&#39;</span><span class="p">:</span>
                             <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s1">&#39;etalon_1_amp_1_1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The params file is then used to fit the spectra in the dataset using the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet.fit_data" title="MATS.fit_dataset.Fit_DataSet.fit_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fit_DataSet.fit_data()</span></code></a> function, where the result is a lmfit result object. The lmft prettyprint function prints the parameter fit results.  Included below is an abbreviated prettyprint output that not only shows the fit result values and standard errors, but also highlights that constraints were imposed on the SD_gamma (speed dependent broadening) parameters and an expression was imposed on the etalon_amplitudes.  It also shows that the there is a line intensity reported for every line and spectrum (sw_spectrum <a href="#id1"><span class="problematic" id="id2">number_</span></a> line) as the line intensities were not constrained to global fits.  The reported sw shows that the fitted line intensity value is scaled by the minimum fit value.  This scalar term is saved in a column called sw_scale_factor for reference.  Scaling the line intensity aids in the fitting as line intensities are so much smaller than other fitted parameters.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Name</span>                     <span class="n">Value</span>      <span class="n">Min</span>      <span class="n">Max</span>   <span class="n">Stderr</span>     <span class="n">Vary</span>     <span class="n">Expr</span> <span class="n">Brute_Step</span>
<span class="n">Pressure_1_1</span>           <span class="mf">0.07911</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">Pressure_2_1</span>           <span class="mf">0.06556</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">Pressure_3_1</span>           <span class="mf">0.04602</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">Pressure_4_1</span>           <span class="mf">0.02488</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_delta_air_line_1</span>          <span class="mi">0</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_delta_air_line_10</span>         <span class="mi">0</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_delta_air_line_13</span>         <span class="mi">0</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_delta_air_line_25</span>         <span class="mi">0</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_delta_air_line_26</span>         <span class="mi">0</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_gamma_air_line_1</span>        <span class="mf">0.1</span>     <span class="mf">0.01</span>     <span class="mf">0.25</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_gamma_air_line_10</span>    <span class="mf">0.1137</span>     <span class="mf">0.01</span>     <span class="mf">0.25</span> <span class="mf">0.0008273</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_gamma_air_line_13</span>    <span class="mf">0.1313</span>     <span class="mf">0.01</span>     <span class="mf">0.25</span> <span class="mf">0.001115</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_gamma_air_line_25</span>      <span class="mf">0.09</span>     <span class="mf">0.01</span>     <span class="mf">0.25</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">SD_gamma_air_line_26</span>       <span class="mf">0.1</span>     <span class="mf">0.01</span>     <span class="mf">0.25</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="o">.</span> <span class="o">.</span> <span class="o">.</span>
<span class="n">etalon_1_amp_1_1</span>      <span class="mf">0.001762</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span> <span class="mf">4.007e-05</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_amp_2_1</span>      <span class="mf">0.001762</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span> <span class="mf">4.007e-05</span>    <span class="kc">False</span> <span class="n">etalon_1_amp_1_1</span>     <span class="kc">None</span>
<span class="n">etalon_1_amp_3_1</span>      <span class="mf">0.001762</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span> <span class="mf">4.007e-05</span>    <span class="kc">False</span> <span class="n">etalon_1_amp_1_1</span>     <span class="kc">None</span>
<span class="n">etalon_1_amp_4_1</span>      <span class="mf">0.001762</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span> <span class="mf">4.007e-05</span>    <span class="kc">False</span> <span class="n">etalon_1_amp_1_1</span>     <span class="kc">None</span>
<span class="n">etalon_1_freq_1_1</span>        <span class="mf">1.196</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_freq_2_1</span>        <span class="mf">1.196</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_freq_3_1</span>        <span class="mf">1.196</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_freq_4_1</span>        <span class="mf">1.196</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_phase_1_1</span>     <span class="o">-</span><span class="mf">0.3479</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>  <span class="mf">0.04585</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_phase_2_1</span>    <span class="o">-</span><span class="mf">0.09384</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>  <span class="mf">0.04288</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_phase_3_1</span>       <span class="o">-</span><span class="mf">1.04</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>  <span class="mf">0.04446</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">etalon_1_phase_4_1</span>      <span class="o">-</span><span class="mf">1.266</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>  <span class="mf">0.04394</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">gamma0_air_line_1</span>         <span class="mf">0.04</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">gamma0_air_line_10</span>     <span class="mf">0.04501</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span> <span class="mf">4.919e-05</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">gamma0_air_line_13</span>     <span class="mf">0.04339</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span> <span class="mf">7.531e-05</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">gamma0_air_line_25</span>        <span class="mf">0.04</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">gamma0_air_line_26</span>        <span class="mf">0.04</span>     <span class="o">-</span><span class="n">inf</span>      <span class="n">inf</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="o">.</span> <span class="o">.</span> <span class="o">.</span>
<span class="n">sw_1_line_1</span>              <span class="mf">4.369</span>    <span class="mf">2.184</span>    <span class="mf">8.738</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_1_line_10</span>             <span class="mf">4.735</span>      <span class="mf">2.4</span>    <span class="mf">9.598</span> <span class="mf">0.0008558</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_1_line_13</span>             <span class="mf">3.087</span>    <span class="mf">1.562</span>    <span class="mf">6.246</span> <span class="mf">0.0007302</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_1_line_25</span>             <span class="mf">2.083</span>    <span class="mf">1.042</span>    <span class="mf">4.166</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_1_line_26</span>             <span class="mf">3.399</span>    <span class="mf">1.699</span>    <span class="mf">6.798</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_2_line_1</span>              <span class="mf">4.369</span>    <span class="mf">2.184</span>    <span class="mf">8.738</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_2_line_10</span>             <span class="mf">4.752</span>      <span class="mf">2.4</span>    <span class="mf">9.598</span> <span class="mf">0.0006929</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_2_line_13</span>             <span class="mf">3.091</span>    <span class="mf">1.562</span>    <span class="mf">6.246</span> <span class="mf">0.0006913</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_2_line_25</span>             <span class="mf">2.083</span>    <span class="mf">1.042</span>    <span class="mf">4.166</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_2_line_26</span>             <span class="mf">3.399</span>    <span class="mf">1.699</span>    <span class="mf">6.798</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_3_line_1</span>              <span class="mf">4.369</span>    <span class="mf">2.184</span>    <span class="mf">8.738</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_3_line_10</span>             <span class="mf">4.744</span>      <span class="mf">2.4</span>    <span class="mf">9.598</span> <span class="mf">0.0007446</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_3_line_13</span>             <span class="mf">3.095</span>    <span class="mf">1.562</span>    <span class="mf">6.246</span> <span class="mf">0.0007499</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_3_line_25</span>             <span class="mf">2.083</span>    <span class="mf">1.042</span>    <span class="mf">4.166</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_3_line_26</span>             <span class="mf">3.399</span>    <span class="mf">1.699</span>    <span class="mf">6.798</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_4_line_1</span>              <span class="mf">4.369</span>    <span class="mf">2.184</span>    <span class="mf">8.738</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_4_line_10</span>               <span class="mf">4.8</span>      <span class="mf">2.4</span>    <span class="mf">9.598</span> <span class="mf">0.001158</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_4_line_13</span>             <span class="mf">3.118</span>    <span class="mf">1.562</span>    <span class="mf">6.246</span>  <span class="mf">0.00117</span>     <span class="kc">True</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_4_line_25</span>             <span class="mf">2.083</span>    <span class="mf">1.042</span>    <span class="mf">4.166</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
<span class="n">sw_4_line_26</span>             <span class="mf">3.399</span>    <span class="mf">1.699</span>    <span class="mf">6.798</span>        <span class="mi">0</span>    <span class="kc">False</span>     <span class="kc">None</span>     <span class="kc">None</span>
</pre></div>
</div>
<p>The last segment of code provides residual plots and updates residuals through the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet.residual_analysis" title="MATS.fit_dataset.Fit_DataSet.residual_analysis"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fit_DataSet.residual_analysis()</span></code></a> and</p>
<p><a class="reference internal" href="MATS.html#MATS.dataset.Dataset.plot_model_residuals" title="MATS.dataset.Dataset.plot_model_residuals"><code class="xref py py-func docutils literal notranslate"><span class="pre">Dataset.plot_model_residuals()</span></code></a> functions, updates the parameter and baseline line lists through</p>
<p><a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet.update_params" title="MATS.fit_dataset.Fit_DataSet.update_params"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fit_DataSet.update_params()</span></code></a>, and generates a summary file with the fit results using</p>
<p><a class="reference internal" href="MATS.html#MATS.dataset.Dataset.generate_summary_file" title="MATS.dataset.Dataset.generate_summary_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">Dataset.generate_summary_file()</span></code></a>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_data</span><span class="o">.</span><span class="n">residual_analysis</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indv_resid_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fit_data</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_summary_file</span><span class="p">(</span><span class="n">save_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">SPECTRA</span><span class="o">.</span><span class="n">plot_model_residuals</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/spectra_residuals.png" src="_images/spectra_residuals.png" />
<p>Call to the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum.fft_spectrum" title="MATS.spectrum.Spectrum.fft_spectrum"><code class="xref py py-func docutils literal notranslate"><span class="pre">Spectrum.fft_spectrum()</span></code></a> function takes an FFT of the residuals. If we hadn’t included the etalon, the result of the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum.fft_spectrum" title="MATS.spectrum.Spectrum.fft_spectrum"><code class="xref py py-func docutils literal notranslate"><span class="pre">Spectrum.fft_spectrum()</span></code></a> function would show a peak with the most abundant period being 1.271443 cm-1 and an amplitude of 0.001364, which were used as the initial guess for the etalon in the spectrum class definitions. The more etalon periods present in the spectral region being fit the more precise the etalon amplitude and frequency determined by the FFT will be.</p>
<p>If we hadn’t included the etalon, the fit residuals and FFT would like the plots below:</p>
<img alt="_images/spectra_residuals_noetalon.png" src="_images/spectra_residuals_noetalon.png" />
<img alt="_images/Noetalon_FFT.png" src="_images/Noetalon_FFT.png" />
<p>Using these values as the etalon period and amplitude give the fit residuals shown in the use example above and when incorporated the FFT no longer shows a substantial peak at 1.271443 cm-1.</p>
<img alt="_images/etalon_FFT.png" src="_images/etalon_FFT.png" />
</section>
<section id="explore-the-ability-to-weight-spectra">
<h2>Explore the Ability to Weight Spectra<a class="headerlink" href="#explore-the-ability-to-weight-spectra" title="Permalink to this headline">¶</a></h2>
<p>MATS v2 introduced the ability to weight spectra in two different ways, using the stats column defined for each spectrum or weighting the entire spectrum.  In the first example below, we use use the same code that was introduced previously, but set the weight_spectra variable in the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet" title="MATS.fit_dataset.Fit_DataSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fit_DataSet</span></code></a> definitions to True.</p>
<p>This weights the contribution to the solution at each point in each spectrum by 1/tau_stats_column.  If the tau_stats_column is not defined in the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> then this will default to equal weights for all data points.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_data</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Fit_DataSet</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span><span class="s1">&#39;Baseline_LineList&#39;</span><span class="p">,</span> <span class="s1">&#39;Parameter_LineList&#39;</span><span class="p">,</span> <span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">weight_spectra</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">baseline_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">baseline_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="n">molefraction_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">molefraction_limit_factor</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span>
             <span class="n">etalon_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">etalon_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">#phase is constrained to +/- 2pi,</span>
             <span class="n">x_shift_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">x_shift_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
             <span class="n">nu_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nu_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
             <span class="n">sw_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sw_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">gamma0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_gamma0_limit</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">delta0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">delta0_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_delta0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_delta0_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">SD_gamma_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">SD_gamma_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_gamma2_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_gamma2_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">SD_delta_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">SD_delta_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">n_delta2_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_delta2_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">nuVC_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nuVC_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_nuVC_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_nuVC_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">eta_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">eta_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">linemixing_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linemixing_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">generate_params</span><span class="p">()</span>



<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
 <span class="k">if</span> <span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
     <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
         <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">min</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
 <span class="k">if</span> <span class="s1">&#39;etalon_1_amp&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
     <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;etalon_1_amp_1_1&#39;</span><span class="p">:</span>
         <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s1">&#39;etalon_1_amp_1_1&#39;</span><span class="p">)</span>




<span class="n">result</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">())</span>

<span class="n">fit_data</span><span class="o">.</span><span class="n">residual_analysis</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indv_resid_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fit_data</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_summary_file</span><span class="p">(</span><span class="n">save_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">SPECTRA</span><span class="o">.</span><span class="n">plot_model_residuals</span><span class="p">()</span>
</pre></div>
</div>
<p>For this example the statistics are relatively consistent across all points in the dataset, as shown in the plot below, so the fit residuals are very similar with some slight differences in the quality of fits and the parameter fit results.</p>
<img alt="_images/spectra_residuals_ptbypt_weight.png" src="_images/spectra_residuals_ptbypt_weight.png" />
<p>The other option for weighting, that can be used with or without the point by point weighting, is to weight each spectrum by setting the spectrum weight value.  The default for each spectrum is 1.  This value can be set through the weight parameter in the spectrum definition or by using the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum.set_weight" title="MATS.spectrum.Spectrum.set_weight"><code class="xref py py-func docutils literal notranslate"><span class="pre">Spectrum.set_weight()</span></code></a> function, which is shown below.</p>
<p>For all weighting options, the residuals are adjusted by the weight factors.  For this example, where the spec_1 is given a weight of 0 this effectively removed spec_1 from the solution consideration depicted by the flat residuals for spectrum 190510_2per_43_forfit.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spec_1</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">FITPARAMS</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Generate_FitParam_File</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span> <span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">BASE_LINELIST</span><span class="p">,</span> <span class="n">lineprofile</span> <span class="o">=</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">,</span> <span class="n">linemixing</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">threshold_intensity</span> <span class="o">=</span> <span class="n">IntensityThreshold</span><span class="p">,</span> <span class="n">sim_window</span> <span class="o">=</span> <span class="n">wave_range</span><span class="p">,</span>
                               <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="n">aw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eta_constrain</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linemixing_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                               <span class="c1">#additional_columns = [&#39;trans_id&#39;, &#39;local_lower_quanta&#39;, &#39;m&#39;])</span>

<span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_param_linelist_from_linelist</span><span class="p">(</span><span class="n">vary_nu</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_sw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                 <span class="n">vary_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                 <span class="n">vary_aw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="mi">1</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_gamma2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_as</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_delta2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span> <span class="n">vary_n_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}},</span>
                                                 <span class="n">vary_eta</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_linemixing</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>

<span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_baseline_linelist</span><span class="p">(</span><span class="n">vary_baseline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">vary_xshift</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">vary_etalon_amp</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_etalon_period</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_etalon_phase</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>



<span class="n">fit_data</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Fit_DataSet</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span><span class="s1">&#39;Baseline_LineList&#39;</span><span class="p">,</span> <span class="s1">&#39;Parameter_LineList&#39;</span><span class="p">,</span> <span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">weight_spectra</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">baseline_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">baseline_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="n">molefraction_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">molefraction_limit_factor</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span>
             <span class="n">etalon_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">etalon_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">#phase is constrained to +/- 2pi,</span>
             <span class="n">x_shift_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">x_shift_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
             <span class="n">nu_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nu_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
             <span class="n">sw_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sw_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">gamma0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_gamma0_limit</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">delta0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">delta0_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_delta0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_delta0_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">SD_gamma_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">SD_gamma_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_gamma2_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_gamma2_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">SD_delta_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">SD_delta_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">n_delta2_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_delta2_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">nuVC_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nuVC_limit_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_nuVC_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_nuVC_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
             <span class="n">eta_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">eta_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">linemixing_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linemixing_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">generate_params</span><span class="p">()</span>



<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
 <span class="k">if</span> <span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
     <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
         <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">min</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
 <span class="k">if</span> <span class="s1">&#39;etalon_1_amp&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
     <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;etalon_1_amp_1_1&#39;</span><span class="p">:</span>
         <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s1">&#39;etalon_1_amp_1_1&#39;</span><span class="p">)</span>




<span class="n">result</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">())</span>

<span class="n">fit_data</span><span class="o">.</span><span class="n">residual_analysis</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indv_resid_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fit_data</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_summary_file</span><span class="p">(</span><span class="n">save_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">SPECTRA</span><span class="o">.</span><span class="n">plot_model_residuals</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/spectra_residuals_ptbypt_spectrum_weight.png" src="_images/spectra_residuals_ptbypt_spectrum_weight.png" />
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="Examples.html"
                        title="previous chapter">Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Fitting%20Synthetic%20Spectra.html"
                        title="next chapter">Fitting Synthetic Spectra</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Fitting%20Synthetic%20Spectra.html" title="Fitting Synthetic Spectra"
             >next</a> |</li>
        <li class="right" >
          <a href="Examples.html" title="Examples"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MATS 2.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Examples.html" >Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Fitting Experimental Spectra</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>