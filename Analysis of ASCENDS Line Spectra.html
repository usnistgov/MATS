
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Analysis of ASCENDS Line Spectra &#8212; MATS 3 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Applying Analytical Correction to hardness of collisions for HTP" href="Applying%20Analytical%20Correction%20to%20hardness%20of%20collisions%20for%20HTP.html" />
    <link rel="prev" title="Fitting Synthetic Spectra" href="Fitting%20Synthetic%20Spectra.html" />
<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
<script>
$(document).ready(function(){
  // Mark external (non-nist.gov) A tags with class "external"
  //If the adress start with https and ends with nist.gov
  var re_nist = new RegExp('^https?:\/\/((^\/)*\.)*nist\\.gov(\/|$)');
  //Regex to find address that start with https
  var re_absolute_address = new RegExp('^((https?:)?\/\/)');
  $("a").each(function(){
    var url=$(this).attr('href');
    if(re_nist.test(url) || !re_absolute_address.test(url)){
      $(this).addClass('local');
    }else{
      //This a href appears to be external, so tag it
      $(this).addClass('external');
    }
  });
  // Add leaveNotice to external A elements
  $('a.external').leaveNotice();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Applying%20Analytical%20Correction%20to%20hardness%20of%20collisions%20for%20HTP.html" title="Applying Analytical Correction to hardness of collisions for HTP"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Fitting%20Synthetic%20Spectra.html" title="Fitting Synthetic Spectra"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MATS 3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Examples.html" accesskey="U">Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Analysis of ASCENDS Line Spectra</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="analysis-of-ascends-line-spectra">
<h1>Analysis of ASCENDS Line Spectra<a class="headerlink" href="#analysis-of-ascends-line-spectra" title="Permalink to this heading">¶</a></h1>
<p>Provided in the MATS v2 release are several examples highlighting MATS capabilities, which can be found in the MATS <a class="reference external" href="https://github.com/usnistgov/MATS/tree/master/Examples">examples folder</a>.</p>
<p>The 30012&lt;–00001 CO2 band is frequently used for remote sensing applications, where the R16e line in this band centered at 6359.967 cm-1 is the target line for the ASCENDS - Active Sensing of CO2 Emissions over Nights, Days, and Seasons mission.  This makes this line an important target for spectroscopic reference data and thus a convenient target for single line spectroscopic studies or examples.</p>
<p>Data originally reported in <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022407315001338">Long, D., et al., Frequency-agile, rapid scanning cavity ring-down spectroscopy (FARS-CRDS) measurements of the (30012)←(00001) near-infrared carbon dioxide band. Journal of Quantitative Spectroscopy and Radiative Transfer, 2015. 161: p. 35-40</a>.  This example is explicitly referenced in the Adkins and Hodges, Assessment of the precision, bias and numerical correlation of fitted parameters obtained by multi-spectrum fits of the Hartmann-Tran line profile to simulated spectra, JQSRT (under review).</p>
<p><a class="reference external" href="https://github.com/usnistgov/MATS/tree/master/Examples/ASCENDS_Fitting">This example</a>. shows the fitting of real experimental data.  This data has a non-zero baseline and several etalons that need to be considered in order to effectively fit the spectra.  In addition to fitting the experimental spectra, this example also uses simulations to explore the anticipated impact of improving the SNR of the data and increasing the pressure range of the dataset.</p>
<section id="define-spectra">
<h2>Define Spectra<a class="headerlink" href="#define-spectra" title="Permalink to this heading">¶</a></h2>
<p>Module import follows from the <a class="reference internal" href="Fitting%20Experimental%20Spectra.html#fitting-experimental-spectra"><span class="std std-ref">Fitting Experimental Spectra</span></a> and <a class="reference internal" href="Fitting%20Synthetic%20Spectra.html#fitting-synthetic-spectra"><span class="std std-ref">Fitting Synthetic Spectra</span></a> examples.  The experimental spectra and the linelists are read-in in the same manner as described in the <a class="reference internal" href="Fitting%20Experimental%20Spectra.html#fitting-experimental-spectra"><span class="std std-ref">Fitting Experimental Spectra</span></a> example.</p>
<p>In this example three etalons are included in the simulation and linear baseine is considered for each spectrum in the dataset.  These fits also make use of the segment column, which allows the spectrum-specific parameters (baseline, etalons) to be treated on smaller segments of the spectrum, opposed to across the whole spectrum. The segment column is set using the segment_column parameter in the <a class="reference internal" href="MATS.html#MATS.spectrum.Spectrum" title="MATS.spectrum.Spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Spectrum</span></code></a> definition and is simply the name of a column in the spectrum .csv that contains integers that are common for continuous segments of the spectrum.   This is especially useful for treatment of faster etalons, which may not maintain a consistent phase over entire spectrum.  Additional constraints can be imposed to help with fit convergence and physical modeling.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MATS.linelistdata</span> <span class="kn">import</span> <span class="n">linelistdata</span>
<span class="kn">import</span> <span class="nn">MATS.hapi</span> <span class="k">as</span> <span class="nn">hapi</span>

<span class="n">wave_range</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="c1">#range outside of experimental x-range to simulate</span>
<span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span> <span class="c1">#intensities must be above this value to be simulated</span>
<span class="n">Fit_Intensity</span> <span class="o">=</span> <span class="mf">1e-23</span> <span class="c1">#intensities must be above this value for the line to be fit</span>
<span class="n">order_baseline_fit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">tau_column</span> <span class="o">=</span> <span class="s1">&#39;Alpha&#39;</span> <span class="c1"># Mean tau/us</span>
<span class="n">freq_column</span> <span class="o">=</span> <span class="s1">&#39;Wavenumber&#39;</span> <span class="c1"># Total Frequency /MHz</span>
<span class="n">pressure_column</span> <span class="o">=</span> <span class="s1">&#39;Pressure&#39;</span>
<span class="n">temperature_column</span> <span class="o">=</span> <span class="s1">&#39;Temperature&#39;</span>
<span class="n">tau_stats_column</span> <span class="o">=</span> <span class="kc">None</span>


<span class="n">PARAM_LINELIST</span> <span class="o">=</span> <span class="n">linelistdata</span><span class="p">[</span><span class="s1">&#39;JQSRT2021_SDNGP_2015&#39;</span><span class="p">]</span>
<span class="n">PARAM_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;n_delta0_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;n_delta0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">etalons</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mf">0.004321</span><span class="p">,</span><span class="mf">1.168</span><span class="p">],</span> <span class="mi">2</span><span class="p">:[</span><span class="mf">0.001377</span><span class="p">,</span> <span class="mf">59.38</span><span class="p">],</span> <span class="mi">3</span><span class="p">:[</span><span class="mf">0.0004578</span><span class="p">,</span> <span class="mf">29.75</span><span class="p">]}</span>


<span class="n">spec_1</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_56Torr_03_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>


<span class="n">spec_2</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_83Torr_02_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>

<span class="n">spec_3</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_101Torr_01_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>

<span class="n">spec_4</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_109Torr_03_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                  <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>

<span class="n">spec_5</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_152Torr_01_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>

<span class="n">spec_6</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_186Torr_03_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>

<span class="n">spec_7</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_269Torr_01_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>

<span class="n">spec_8</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="s1">&#39;spectrum_CO2_Air_1%Ar_271Torr_03_formatted_R16e&#39;</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span>
                                                                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                                <span class="n">baseline_order</span> <span class="o">=</span> <span class="n">order_baseline_fit</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment&#39;</span><span class="p">,</span>
                                                                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="n">freq_column</span><span class="p">,</span>
                                                                <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span><span class="p">,</span>
                                                                <span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span><span class="p">,</span>
                                                                <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mf">0.00</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="construct-dataset-and-generate-fit-parameters">
<h2>Construct Dataset and Generate Fit Parameters<a class="headerlink" href="#construct-dataset-and-generate-fit-parameters" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="MATS.html#MATS.dataset.Dataset" title="MATS.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a> object is defined as is outlined in the <a class="reference internal" href="Fitting%20Experimental%20Spectra.html#fitting-experimental-spectra"><span class="std std-ref">Fitting Experimental Spectra</span></a> and <a class="reference internal" href="Fitting%20Synthetic%20Spectra.html#fitting-synthetic-spectra"><span class="std std-ref">Fitting Synthetic Spectra</span></a> examples.</p>
<p>The baseline and parameter fit parameter files are generated using the <a class="reference internal" href="MATS.html#MATS.generate_fitparam_file.Generate_FitParam_File" title="MATS.generate_fitparam_file.Generate_FitParam_File"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generate_FitParam_File</span></code></a> class.  In this example, the line intensity is allowed to float for each spectrum, but all other line shape parameters are constrained to their pressure dependence.  <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022407315001338">Long et al.</a> fixed the beyond Voigt SDNGP line shape parameters to those reported by <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022407315001284">Lin, H., et al., Cavity ring-down spectrometer for high-fidelity molecular absorption measurements. Journal of Quantitative Spectroscopy and Radiative Transfer, 2015. 161: p. 11-20</a> , while allowing the VP parameters and line mixing to float.  In this example, we are allowing all SDNGP parameters to float using the <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022407315001284">Lin et al. values</a> as the initial guess, but only considering spectra in the isolated transition pressure regime, where line mixing can be ignored.</p>
<p>The slope and intercept for the baseline of each spectra are floated, along with the amplitude, period, and phase of each etalon.  Because this example uses the segment function, you can see that each spectrum has 4 segments in the print out of the baseline linelist, so the number of rows in the baseline fit parameter list is four times larger than the number of spectra.  Additional constraints will be added to the etalon parameters in the next section.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SPECTRA</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Dataset</span><span class="p">([</span><span class="n">spec_1</span><span class="p">,</span> <span class="n">spec_2</span><span class="p">,</span> <span class="n">spec_3</span><span class="p">,</span> <span class="n">spec_4</span><span class="p">,</span> <span class="n">spec_5</span><span class="p">,</span> <span class="n">spec_6</span><span class="p">,</span> <span class="n">spec_7</span><span class="p">,</span> <span class="n">spec_8</span><span class="p">],</span> <span class="s1">&#39;MATS_Example&#39;</span><span class="p">,</span><span class="n">PARAM_LINELIST</span><span class="p">)</span>

<span class="c1">#Generate Baseline Parameter list based on number of etalons in spectra definitions and baseline order</span>
<span class="n">BASE_LINELIST</span> <span class="o">=</span> <span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_baseline_paramlist</span><span class="p">()</span>



     <span class="n">FITPARAMS</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Generate_FitParam_File</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span> <span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">BASE_LINELIST</span><span class="p">,</span> <span class="n">lineprofile</span> <span class="o">=</span> <span class="s1">&#39;SDNGP&#39;</span><span class="p">,</span> <span class="n">linemixing</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                                                       <span class="n">fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">threshold_intensity</span> <span class="o">=</span> <span class="n">IntensityThreshold</span><span class="p">,</span> <span class="n">sim_window</span> <span class="o">=</span> <span class="n">wave_range</span><span class="p">,</span>
                                                                                       <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                                                                        <span class="n">aw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                                                                        <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eta_constrain</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linemixing_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                                                                             <span class="n">additional_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;local_lower_quanta&#39;</span><span class="p">])</span>

     <span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_param_linelist_from_linelist</span><span class="p">(</span><span class="n">vary_nu</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span> <span class="n">vary_sw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                                                                      <span class="n">vary_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                      <span class="n">vary_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                      <span class="n">vary_aw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                      <span class="n">vary_as</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                      <span class="n">vary_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                                                                      <span class="n">vary_eta</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_linemixing</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>
     <span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_baseline_linelist</span><span class="p">(</span><span class="n">vary_baseline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">vary_pressure</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_temperature</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_xshift</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                                                     <span class="n">vary_etalon_amp</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_etalon_period</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_etalon_phase</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/ASCENDS_baselineparameters.png" src="_images/ASCENDS_baselineparameters.png" />
</section>
<section id="fit-spectra">
<h2>Fit Spectra<a class="headerlink" href="#fit-spectra" title="Permalink to this heading">¶</a></h2>
<p>The fitting of the dataset is looped to iterate on the fit results.  The result and residual plots are shown after each iteration (with the first and last iteration shown below).  In the first few iterations not all of the etalons are well modeled leading to systematic residuals, iterating on the best fit results helps better model the etalons minimizing the residuals.</p>
<p>Using the segments in a spectrum, allows us to model the spectrum specific parameters by segment opposed to across the whole spectrum.  However, this flexibility can lead to divergent solutions if additional constraints aren’t included.  This example will constrain these parameters using the <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet.constrained_baseline" title="MATS.fit_dataset.Fit_DataSet.constrained_baseline"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fit_DataSet.constrained_baseline()</span></code></a> function and by setting constraints directly in the lmfit parameter dictionary.  The <a class="reference internal" href="MATS.html#MATS.fit_dataset.Fit_DataSet.constrained_baseline" title="MATS.fit_dataset.Fit_DataSet.constrained_baseline"><code class="xref py py-func docutils literal notranslate"><span class="pre">Fit_DataSet.constrained_baseline()</span></code></a> function indicates the baseline parameters that should be constrained to be equal across the entire spectrum (parameters that won’t take advantage of the segment structure).  For this example the baseline and etalon periods are constrained to be equal equal across the entire spectrum.</p>
<p>This example also sets a few additional constraints on the etalons.  First, the period of each etalon is set to be equal across all spectra in the dataset.  Second, the phase of the first etalon is constrained to be equal across each spectrum.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">iterations</span><span class="p">:</span>
        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Fit_DataSet</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span><span class="s1">&#39;Baseline_LineList&#39;</span><span class="p">,</span> <span class="s1">&#39;Parameter_LineList&#39;</span><span class="p">,</span> <span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">generate_params</span><span class="p">()</span>




        <span class="n">fit_data</span><span class="o">.</span><span class="n">constrained_baseline</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">baseline_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">xshift_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">molefraction_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                                                                <span class="n">etalon_amp_segment_constrained</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">etalon_period_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">etalon_phase_segment_constrained</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                                                <span class="n">pressure_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">temperature_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


        <span class="n">minimum_segment_spec_1</span> <span class="o">=</span> <span class="n">spec_1</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>


        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>

                <span class="k">if</span> <span class="s1">&#39;etalon_1_period_&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                        <span class="c1">#Sets the period of etalon_1 to be equal for all spectra</span>
                        <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;etalon_1_period_1_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)):</span>
                                <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s1">&#39;etalon_1_period_1_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)))</span>
                <span class="k">if</span> <span class="s1">&#39;etalon_1_phase_&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                        <span class="c1">#Constrains the phase of etalon_1 across each spectrum</span>
                        <span class="n">start_</span> <span class="o">=</span>  <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
                        <span class="n">end_</span> <span class="o">=</span>  <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">spectrum_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">start_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">end_</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;etalon_1_phase_&#39;</span><span class="o">+</span><span class="n">spectrum_number</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)):</span>
                                <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span> <span class="s1">&#39;etalon_1_phase_&#39;</span><span class="o">+</span><span class="n">spectrum_number</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)))</span>

                <span class="k">if</span> <span class="s1">&#39;etalon_2_period_&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                        <span class="c1">#Sets the period of etalon_1 to be equal for all spectra</span>
                        <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;etalon_2_period_1_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)):</span>
                                <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s1">&#39;etalon_2_period_1_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)))</span>

                <span class="k">if</span> <span class="s1">&#39;etalon_3_period_&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                        <span class="c1">#Sets the period of etalon_1 to be equal for all spectra</span>
                        <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;etalon_3_period_1_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)):</span>
                                <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s1">&#39;etalon_3_period_1_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minimum_segment_spec_1</span><span class="p">)))</span>


        <span class="n">result</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>


        <span class="n">fit_data</span><span class="o">.</span><span class="n">residual_analysis</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indv_resid_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fit_data</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_summary_file</span><span class="p">(</span><span class="n">save_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">SPECTRA</span><span class="o">.</span><span class="n">plot_model_residuals</span><span class="p">()</span>
        <span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="n">iterations</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">())</span>
</pre></div>
</div>
<p>ITERATION 1</p>
<img alt="_images/ASCENDS_Iteration_1.png" src="_images/ASCENDS_Iteration_1.png" />
<p>ITERATION 2</p>
<img alt="_images/ASCENDS_Iteration_5.png" src="_images/ASCENDS_Iteration_5.png" />
</section>
<section id="compare-to-literature">
<h2>Compare to Literature<a class="headerlink" href="#compare-to-literature" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022407315001284">Lin et al.</a> work reported spectra with QFs between 11000 and 29000 for pressures between 1.33kPa and 26.7kPa.  The current example work was conducted over a slightly higher pressure range of  7.5 to 36 kPa and had QFs of about 1500.</p>
<p>The  <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022407315001284">Lin et al.</a> work reports uncertainty on the collisional broadening of 0.1%, the pressure shift of 0.35%, the speed-dependent broadening of 0.2%, the speed-dependent shift of 20%, and the Dicke narrowing of 1%.  The code below compares the results from the <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022407315001284">Lin et al.</a> and current fit example including a plot highlighting the reported relative uncertainty in line shape parameters reported by the fits.  The current example shows much higher fit uncertainties for speed-dependent width and Dicke narrowing, which indicates that at this QF and pressure range the spectra used in this analysis have a difficult time distinguishing between these narrowing mechanisms.  This motivates a Monte Carlo analysis that explores how improving the SNR and pressure range would decrease the uncertainty in the reported line shape parameters.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Compare_Results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">,</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">,</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span>

<span class="c1">#Get Spectra line number from the parameter results list.  Alternatively, could read in the Linelist file and parse the same way as the initial Parameter linelist</span>
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">line_number</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;SD_gamma_air_line_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="c1"># Get Lin et al Parameter values and uncertainties</span>
        <span class="n">Compare_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parameter</span><span class="p">,</span> <span class="s1">&#39;Lin et al. Value&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">PARAM_LINELIST</span><span class="p">[(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;local_lower_quanta&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;R16e&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;global_upper_quanta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">30012</span><span class="p">)][</span><span class="n">parameter</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lin_reported_uncertainty</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">:</span><span class="mf">0.35</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">Compare_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parameter</span><span class="p">,</span> <span class="s1">&#39;Lin et al. Uncertainty (%)&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">lin_reported_uncertainty</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span>

        <span class="c1"># Get Parameter results from fitting</span>
        <span class="n">Compare_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parameter</span><span class="p">,</span> <span class="s1">&#39;Fit Value&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">parameter</span> <span class="o">+</span> <span class="s1">&#39;_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">Compare_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parameter</span><span class="p">,</span> <span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">parameter</span> <span class="o">+</span> <span class="s1">&#39;_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span> <span class="o">/</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">parameter</span> <span class="o">+</span> <span class="s1">&#39;_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Fit Percent Difference (%)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Fit Value&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Lin et al. Value&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Fit Value&#39;</span><span class="p">]</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>


<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">],</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Lin et al. Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lin et al. (2015)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">],</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Current Example&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;$\gamma_</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\delta_</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$a_</span><span class="si">{w}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$a_</span><span class="si">{s}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">nu_</span><span class="si">{VC}</span><span class="s1">$&#39;</span> <span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;line profile parameter&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Reported Fit Uncertainty (%)&#39;</span><span class="p">)</span>

<span class="c1">#plt.bar(Compare_Results[&#39;Parameters&#39;], Compare_Results[&#39;Lin et al. Percent Difference (%)&#39;])</span>
<span class="c1">#plt.errorbar(Compare_Results[&#39;Parameters&#39;], Compare_Results[&#39;Lin et al. Percent Difference (%)&#39;], yerr=Compare_Results[&#39;Lin et al. Uncertainty (%)&#39;], fmt=&quot;o&quot;, color=&quot;r&quot;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">Compare_Results</span>
</pre></div>
</div>
<img alt="_images/ASCENDS_FitUncertaintyComparison.png" src="_images/ASCENDS_FitUncertaintyComparison.png" />
</section>
<section id="monte-carlo-analysis">
<h2>Monte Carlo Analysis<a class="headerlink" href="#monte-carlo-analysis" title="Permalink to this heading">¶</a></h2>
<p>The Monte Carlo uncertainty analysis involves running numerous iterations fitting synthetic spectra at experimental conditions.  To simplify the analysis the simulation line list only includes the R16e line and will use the results of the experimental fits as the simulation values.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate linelist only using the R16e line and using the results from the experimental fits</span>
<span class="n">SIMULATION_LINELIST</span> <span class="o">=</span> <span class="n">PARAM_LINELIST</span><span class="p">[(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;local_lower_quanta&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;R16e&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;global_upper_quanta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">30012</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


<span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;gamma0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma0_air_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;delta0_air_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nuVC_air_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SD_gamma_air_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SD_delta_air_line_&#39;</span> <span class="o">+</span> <span class="n">line_number</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y_air_296&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">SIMULATION_LINELIST</span><span class="p">[</span><span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Additionally, a dataframe summarizing the pressures and SNR (approximated by the QF from fits to the experimental spectra) are necessary for defining the simulation conditions.  In this analysis we are comparing the synthetic results at experimetnal conditions, to those with three addtional low pressure spectra and with SNR of 5000 (about three times larger than observed in the experimental spectra).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pressure and QF of Fit Results for Simulation at Experiment Conditions</span>
<span class="n">Exp_Simulation_conditions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">Exp_Simulation_conditions</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPECTRA</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">()</span>
<span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">SPECTRA</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
        <span class="n">Exp_Simulation_conditions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Exp_Simulation_conditions</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">,</span><span class="s1">&#39;SNR&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
        <span class="n">Exp_Simulation_conditions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Exp_Simulation_conditions</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">,</span><span class="s1">&#39;Pressures&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">get_pressure_torr</span><span class="p">())</span>

<span class="n">New_Simulation_conditions</span> <span class="o">=</span> <span class="n">Exp_Simulation_conditions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">New_Simulation_conditions</span><span class="p">[</span><span class="s1">&#39;SNR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">new_pressures</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pressures&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="s1">&#39;SNR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]})</span>
<span class="n">New_Simulation_conditions</span> <span class="o">=</span> <span class="n">New_Simulation_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_pressures</span><span class="p">)</span>
</pre></div>
</div>
<p>In the Monte Carlo simulation the inital guesses will be perturbed from the simulation value by the uncertainty reported in the experimental fit.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gamma0_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gamma0_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>
<span class="n">delta0_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>
<span class="n">aw_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="c1">#per</span>
<span class="n">as_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>
<span class="n">nuVC_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>
</pre></div>
</div>
<p>We define a function to generate spectrum based on the input simulation conditions (SNR and pressure) and with a given input linelist.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">simulation_linelist</span><span class="p">):</span>
        <span class="n">sample_molefraction</span> <span class="o">=</span>  <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mf">0.0004254</span><span class="p">}</span>
        <span class="n">wave_min</span> <span class="o">=</span> <span class="mf">6358.972</span> <span class="c1">#cm-1</span>
        <span class="n">wave_max</span> <span class="o">=</span> <span class="mf">6360.963</span> <span class="c1">#cm-1</span>
        <span class="n">wave_space</span> <span class="o">=</span> <span class="mf">0.006772</span> <span class="c1">#cm-1</span>
        <span class="n">wave_error</span> <span class="o">=</span> <span class="mf">4.67e-7</span>

        <span class="n">etalons</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mf">0.004321</span><span class="p">,</span><span class="mf">1.168</span><span class="p">],</span> <span class="mi">2</span><span class="p">:[</span><span class="mf">0.001377</span><span class="p">,</span> <span class="mf">59.38</span><span class="p">],</span> <span class="mi">3</span><span class="p">:[</span><span class="mf">0.0004578</span><span class="p">,</span> <span class="mf">29.75</span><span class="p">]}</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">simulate_spectrum</span><span class="p">(</span><span class="n">simulation_linelist</span><span class="p">,</span>
                                                         <span class="n">baseline_terms</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                                                        <span class="n">wave_min</span> <span class="o">=</span> <span class="n">wave_min</span><span class="p">,</span> <span class="n">wave_max</span> <span class="o">=</span> <span class="n">wave_max</span><span class="p">,</span>  <span class="n">wave_space</span> <span class="o">=</span> <span class="n">wave_space</span><span class="p">,</span> <span class="n">wave_error</span> <span class="o">=</span> <span class="n">wave_error</span><span class="p">,</span>
                                                        <span class="n">SNR</span> <span class="o">=</span> <span class="n">simulation_conditions</span><span class="p">[</span><span class="s1">&#39;SNR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span>
                                                        <span class="n">temperature</span> <span class="o">=</span> <span class="mf">23.25</span><span class="p">,</span>
                                                        <span class="n">pressure</span> <span class="o">=</span> <span class="n">simulation_conditions</span><span class="p">[</span><span class="s1">&#39;Pressures&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                        <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>  <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span>
                                                        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">[</span><span class="s1">&#39;Pressures&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39;torr&#39;</span><span class="p">,</span>
                                                        <span class="n">molefraction</span> <span class="o">=</span> <span class="n">sample_molefraction</span><span class="p">,</span>
                                                        <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span> <span class="n">num_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spec</span>
</pre></div>
</div>
<p>The <a href="#id3"><span class="problematic" id="id4">mc_</span></a> function defined below simply takes the simulation conditions and number of iterations as inputs.  Spectra are simulated at the conditions outlined in the simulation condition dataframe for just the R16e line using the linelist determined from the fits to the experimental spectra.  Again, the inital guesses for the fitting are perturbed randomly at the magnitude of the reported fit error of the fits to the experimental data.  The fits are conducted in the same manner as those to the experimental data without the use of the segment function.  Results from each iteration are saved to a MC_result .csv file.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mc_</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">simulation_conditions</span><span class="p">,</span> <span class="n">MC_result_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Runs the MC simulation for given number of iterations using the pressures and SNR defined in simulation condition dataframe for the R16e line and saves results to file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">MC_Results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
        <span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SIMULATION_LINELIST</span><span class="p">[</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;delta0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SIMULATION_LINELIST</span><span class="p">[</span><span class="s1">&#39;delta0_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SIMULATION_LINELIST</span><span class="p">[</span><span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;SD_delta_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SIMULATION_LINELIST</span><span class="p">[</span><span class="s1">&#39;SD_delta_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SIMULATION_LINELIST</span><span class="p">[</span><span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;y_air_296&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SIMULATION_LINELIST</span><span class="p">[</span><span class="s1">&#39;y_air_296&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>

                <span class="c1">#Read in Possible linelists</span>
                <span class="n">PARAM_LINELIST</span> <span class="o">=</span> <span class="n">SIMULATION_LINELIST</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">)</span> <span class="o">==</span><span class="mi">8</span><span class="p">:</span>
                        <span class="n">spec_1</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_2</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_3</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_4</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_5</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_6</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_7</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_8</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">SPECTRA</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Dataset</span><span class="p">([</span><span class="n">spec_1</span><span class="p">,</span> <span class="n">spec_2</span><span class="p">,</span> <span class="n">spec_3</span><span class="p">,</span> <span class="n">spec_4</span><span class="p">,</span> <span class="n">spec_5</span><span class="p">,</span> <span class="n">spec_6</span><span class="p">,</span> <span class="n">spec_7</span><span class="p">,</span> <span class="n">spec_8</span><span class="p">],</span> <span class="s1">&#39;Monte Carlo Analysis&#39;</span><span class="p">,</span><span class="n">PARAM_LINELIST</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="n">spec_1</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_2</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_3</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_4</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_5</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_6</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_7</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_8</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_9</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_10</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">spec_11</span> <span class="o">=</span> <span class="n">gen_spec</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">SIMULATION_LINELIST</span><span class="p">)</span>
                        <span class="n">SPECTRA</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Dataset</span><span class="p">([</span><span class="n">spec_1</span><span class="p">,</span> <span class="n">spec_2</span><span class="p">,</span> <span class="n">spec_3</span><span class="p">,</span> <span class="n">spec_4</span><span class="p">,</span> <span class="n">spec_5</span><span class="p">,</span> <span class="n">spec_6</span><span class="p">,</span> <span class="n">spec_7</span><span class="p">,</span> <span class="n">spec_8</span><span class="p">,</span> <span class="n">spec_9</span><span class="p">,</span> <span class="n">spec_10</span><span class="p">,</span> <span class="n">spec_11</span><span class="p">],</span> <span class="s1">&#39;Monte Carlo Analysis&#39;</span><span class="p">,</span><span class="n">PARAM_LINELIST</span><span class="p">)</span>






                <span class="c1">#Generate Baseline Parameter list based on number of etalons in spectra definitions and baseline order</span>
                <span class="n">BASE_LINELIST</span> <span class="o">=</span> <span class="n">SPECTRA</span><span class="o">.</span><span class="n">generate_baseline_paramlist</span><span class="p">()</span>


                <span class="n">gamma0_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gamma0_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>
                <span class="n">delta0_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>
                <span class="n">aw_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="c1">#per</span>
                <span class="n">as_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>
                <span class="n">nuVC_err</span> <span class="o">=</span> <span class="n">Compare_Results</span><span class="p">[</span><span class="n">Compare_Results</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">][</span><span class="s1">&#39;Fit Uncertainty (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#per</span>


                <span class="n">PARAM_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;gamma0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">gamma0_err</span><span class="p">)</span>
                <span class="n">PARAM_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;delta0_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">delta0_err</span><span class="p">)</span>
                <span class="n">PARAM_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">aw_err</span><span class="p">)</span>
                <span class="n">PARAM_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;SD_delta_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">as_err</span><span class="p">)</span>
                <span class="n">PARAM_LINELIST</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="n">PARAM_LINELIST</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]))</span><span class="o">*</span><span class="n">nuVC_err</span><span class="p">)</span>



                <span class="n">FITPARAMS</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Generate_FitParam_File</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span> <span class="n">PARAM_LINELIST</span><span class="p">,</span> <span class="n">BASE_LINELIST</span><span class="p">,</span> <span class="n">lineprofile</span> <span class="o">=</span> <span class="s1">&#39;SDNGP&#39;</span><span class="p">,</span> <span class="n">linemixing</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                                                                  <span class="n">fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">,</span> <span class="n">threshold_intensity</span> <span class="o">=</span> <span class="n">IntensityThreshold</span><span class="p">,</span> <span class="n">sim_window</span> <span class="o">=</span> <span class="n">wave_range</span><span class="p">,</span>
                                                                                                  <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                                                                                   <span class="n">aw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                                                                                   <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eta_constrain</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linemixing_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                                                                                        <span class="n">additional_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;local_lower_quanta&#39;</span><span class="p">])</span>



                <span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_param_linelist_from_linelist</span><span class="p">(</span><span class="n">vary_nu</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span> <span class="n">vary_sw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                                                                                 <span class="n">vary_gamma0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                                 <span class="n">vary_delta0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                                 <span class="n">vary_aw</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                                 <span class="n">vary_as</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
                                                                                                                 <span class="n">vary_nuVC</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">True</span><span class="p">}},</span>
                                                                                                                 <span class="n">vary_eta</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_linemixing</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>
                <span class="n">FITPARAMS</span><span class="o">.</span><span class="n">generate_fit_baseline_linelist</span><span class="p">(</span><span class="n">vary_baseline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_molefraction</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">vary_pressure</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_temperature</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_xshift</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                                                                <span class="n">vary_etalon_amp</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_etalon_period</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_etalon_phase</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


                <span class="n">fit_data</span> <span class="o">=</span> <span class="n">MATS</span><span class="o">.</span><span class="n">Fit_DataSet</span><span class="p">(</span><span class="n">SPECTRA</span><span class="p">,</span><span class="s1">&#39;Baseline_LineList&#39;</span><span class="p">,</span> <span class="s1">&#39;Parameter_LineList&#39;</span><span class="p">,</span> <span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="n">Fit_Intensity</span><span class="p">)</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">generate_params</span><span class="p">()</span>


                <span class="n">result</span> <span class="o">=</span> <span class="n">fit_data</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>

                <span class="n">fit_data</span><span class="o">.</span><span class="n">residual_analysis</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indv_resid_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">fit_data</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="c1">#SPECTRA.generate_summary_file(save_file = True)</span>
                <span class="c1">#SPECTRA.plot_model_residuals()</span>


                <span class="c1">#line Shape Parameters</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;gamma0_air_fit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma0_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;gamma0_air_fit_err&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma0_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;delta0_air_fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;delta0_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;delta0_air_fit_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;delta0_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;nuVC_air_fit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nuVC_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;nuVC_air_fit_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nuVC_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air_fit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SD_gamma_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air_fit_err&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SD_gamma_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air_fit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SD_delta_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air_fit_err&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SD_delta_air_line_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>



                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_1</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_2</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_3</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_4</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_5</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_6</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_7</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_8</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulation_conditions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_9&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_9</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                        <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_10</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
                        <span class="n">MC_Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">MC_Results</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">]</span><span class="o">==</span> <span class="n">iteration</span><span class="p">,</span> <span class="s1">&#39;QF_11&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_11</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>


                <span class="n">MC_Results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">MC_result_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Below are the calls to the <a href="#id5"><span class="problematic" id="id6">mc_</span></a> function at the experimental and new simulation conditions, which will generate and fit 50 iterations of synthetic data for each case.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">Exp_Simulation_conditions</span><span class="p">,</span> <span class="s1">&#39;Experimental_Conditions_MC&#39;</span><span class="p">)</span>
<span class="n">mc_</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">New_Simulation_conditions</span><span class="p">,</span> <span class="s1">&#39;New_Conditions_MC&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameter_eval function summarizes the MC results comparing the fit average and standard deviation across the iterations to the reported fit uncertainty on each iteration.  This also calculates the fractional error compared to the simulation value.  Plots of summary and dataframe are generated for visualization.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parameter_eval</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">report_df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Summarizes MC results for a given parameter</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">,</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">,</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">ax5</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">simulated_column</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">param_avg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span> <span class="o">+</span> <span class="s1">&#39;_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
                <span class="n">param_std</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span> <span class="o">+</span> <span class="s1">&#39;_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                <span class="n">param_err_avg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span> <span class="o">+</span> <span class="s1">&#39;_fit_err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">param_frac_err</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">param_fit_err</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">param_frac_err</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">param_avg</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">param_fit_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">param_std</span> <span class="o">/</span> <span class="n">param_avg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">param_err_avg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">param_err_ratio</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">param_err_ratio</span> <span class="o">=</span> <span class="n">param_std</span><span class="o">/</span><span class="n">param_err_avg</span>

                <span class="n">report_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">report_df</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">simulated_column</span><span class="p">,</span> <span class="s1">&#39;Simulated Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">report_df</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">simulated_column</span><span class="p">,</span> <span class="s1">&#39;Parameter Fit Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_avg</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">report_df</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">simulated_column</span><span class="p">,</span> <span class="s1">&#39;Parameter Fit StDev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_std</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">report_df</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">simulated_column</span><span class="p">,</span> <span class="s1">&#39;Parameter Error Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_err_avg</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">report_df</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">simulated_column</span><span class="p">,</span> <span class="s1">&#39;Parameter Fractional Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_frac_err</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">report_df</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">simulated_column</span><span class="p">,</span> <span class="s1">&#39;Parameter Fit Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fit_err</span>
                <span class="n">report_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">report_df</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">simulated_column</span><span class="p">,</span> <span class="s1">&#39;Error Ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_err_ratio</span>

                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span> <span class="o">+</span> <span class="s1">&#39;_fit&#39;</span><span class="p">],</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span> <span class="o">+</span> <span class="s1">&#39;_fit_err&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">param_avg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">param_avg</span> <span class="o">+</span> <span class="n">param_std</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">linestyles</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">param_avg</span> <span class="o">-</span> <span class="n">param_std</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">linestyles</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">simulated_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">linestyles</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">simulated_column</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;interations&#39;</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Parameter Value&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">report_df</span>
</pre></div>
</div>
<p>The Experimental parameter result table shows good agreement in the fit uncertainty reported in the experimental data and averaged over the iterations of the MC analysis conducted at experimental conditions.  This also provides a measure of the ratio between the standard deviations in the fit values across the iterations compared to the average fit uncertainty.  Ratios greater than one indicate that the fit uncertainty reported by one iteration might under represent the uncertainty, most likely because of correlation between parameters that aren’t included in the calculation of the fit uncertainty.  This ratio, when greater than one, could act as a correction factor to increase the experiment fit uncertainty.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp_MC</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Experimental_Conditions_MC.csv&#39;</span><span class="p">)</span>
<span class="n">new_MC</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;New_Conditions_MC.csv&#39;</span><span class="p">)</span>

<span class="n">EXP_SUMMARY</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Reported Values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gamma0_air&#39;</span><span class="p">,</span> <span class="s1">&#39;delta0_air&#39;</span><span class="p">,</span> <span class="s1">&#39;SD_gamma_air&#39;</span><span class="p">,</span> <span class="s1">&#39;SD_delta_air&#39;</span><span class="p">,</span> <span class="s1">&#39;nuVC_air&#39;</span><span class="p">]</span>
<span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Simulated Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Parameter Fit Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Parameter Fit StDev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Parameter Fractional Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Parameter Fit Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Error Ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">NEW_SUMMARY</span> <span class="o">=</span> <span class="n">EXP_SUMMARY</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">EXP_SUMMARY</span> <span class="o">=</span> <span class="n">parameter_eval</span><span class="p">(</span><span class="n">exp_MC</span><span class="p">,</span> <span class="n">EXP_SUMMARY</span><span class="p">)</span>
<span class="n">EXP_SUMMARY</span>
</pre></div>
</div>
<img alt="_images/ASCENDS_MC_Exp.png" src="_images/ASCENDS_MC_Exp.png" />
<img alt="_images/ASCENDS_MC_Exp_Summary.png" src="_images/ASCENDS_MC_Exp_Summary.png" />
<p>By comparing the average fit uncertainties over MC simulations in the new conditions (higher SNR and 3 extra pressures) to the experimental conditions indicate that the proposed improvements to the experiments can be expected to reduce the uncertainties in the spectroscopic parameters by factors of 2.8 to 3.7.  The largest improvement would be to the Dicke narrowing parameter, which is aided by not only the higher SNR, but also by the inclusion of additional low-pressure spectra that fall in a domain where the Dicke narrowing mechanism dominates over the speed-dependent narrowing.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NEW_SUMMARY</span><span class="o">=</span> <span class="n">parameter_eval</span><span class="p">(</span><span class="n">new_MC</span><span class="p">,</span> <span class="n">NEW_SUMMARY</span><span class="p">)</span>
<span class="n">NEW_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Improvement Over Experiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EXP_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Parameter Fit Error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">NEW_SUMMARY</span><span class="p">[</span><span class="s1">&#39;Parameter Fit Error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">NEW_SUMMARY</span>
</pre></div>
</div>
<img alt="_images/ASCENDS_MC_New.png" src="_images/ASCENDS_MC_New.png" />
<img alt="_images/ASCENDS_MC_New_Summary.png" src="_images/ASCENDS_MC_New_Summary.png" />
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Fitting%20Synthetic%20Spectra.html"
                          title="previous chapter">Fitting Synthetic Spectra</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Applying%20Analytical%20Correction%20to%20hardness%20of%20collisions%20for%20HTP.html"
                          title="next chapter">Applying Analytical Correction to hardness of collisions for HTP</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Applying%20Analytical%20Correction%20to%20hardness%20of%20collisions%20for%20HTP.html" title="Applying Analytical Correction to hardness of collisions for HTP"
             >next</a> |</li>
        <li class="right" >
          <a href="Fitting%20Synthetic%20Spectra.html" title="Fitting Synthetic Spectra"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MATS 3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Examples.html" >Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Analysis of ASCENDS Line Spectra</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>